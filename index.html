<!-- Ð’Ð¸Ð´Ð¶ÐµÑ‚ Ñ‡Ð°Ñ‚Ð° -->
<style>
#support-chat-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  font-size: 28px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

#support-chat-window {
  position: fixed;
  bottom: 90px;
  right: 20px;
  width: 300px;
  max-height: 400px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  display: none;
  flex-direction: column;
  overflow: hidden;
}

#support-chat-header {
  background: #007bff;
  color: white;
  padding: 10px;
  font-weight: bold;
  text-align: center;
  cursor: pointer;
}

#support-chat-messages {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
}

.support-msg {
  margin-bottom: 8px;
  padding: 6px 10px;
  border-radius: 8px;
  max-width: 80%;
  word-break: break-word;
}

.support-msg.me { background: #007bff; color: white; align-self: flex-end; }
.support-msg.other { background: #f1f1f1; color: black; align-self: flex-start; }

#support-chat-input-container {
  display: flex;
  border-top: 1px solid #ddd;
}

#support-chat-input {
  flex: 1;
  padding: 8px;
  border: none;
  outline: none;
}

#support-chat-send {
  background: #007bff;
  color: white;
  border: none;
  padding: 0 15px;
  cursor: pointer;
}
</style>

<button id="support-chat-btn">ðŸ’¬</button>

<div id="support-chat-window">
  <div id="support-chat-header">ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°</div>
  <div id="support-chat-messages"></div>
  <div id="support-chat-input-container">
    <input id="support-chat-input" placeholder="ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ...">
    <button id="support-chat-send">ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
<script>
const gun = Gun({ peers: ['https://gunjs.herokuapp.com/gun'] });
const chat = gun.get('support-chat-widget-room');

const user = 'ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ_' + Math.floor(Math.random()*1000);

const chatBtn = document.getElementById('support-chat-btn');
const chatWindow = document.getElementById('support-chat-window');
const chatHeader = document.getElementById('support-chat-header');
const messagesEl = document.getElementById('support-chat-messages');
const inputEl = document.getElementById('support-chat-input');
const sendBtn = document.getElementById('support-chat-send');

chatBtn.onclick = () => chatWindow.style.display = 'flex';
chatHeader.onclick = () => chatWindow.style.display = 'none';

sendBtn.onclick = sendMessage;
inputEl.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });

function sendMessage() {
  const text = inputEl.value.trim();
  if(!text) return;
  const msg = { id: Date.now() + '_' + Math.random().toString(36).slice(2), user, text };
  chat.set(msg);
  inputEl.value = '';
}

// ÐŸÐ¾Ð´Ð¿Ð¸ÑÐºÐ° Ð½Ð° Ð½Ð¾Ð²Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
const seen = new Set();
chat.map().on(msg => {
  if(!msg || !msg.id || seen.has(msg.id)) return;
  seen.add(msg.id);

  const div = document.createElement('div');
  div.className = 'support-msg ' + (msg.user === user ? 'me' : 'other');
  div.innerText = msg.user + ': ' + msg.text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
});
</script>
